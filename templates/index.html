{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Meeting Room Schedule</h2>
</div>

<!-- Week Navigation -->
<div class="week-navigation {% if week_info.is_current_week %}current-week{% endif %}">
    <div class="week-display">
        {{ week_info.week_display }}
        {% if week_info.is_current_week %}
            <span class="badge bg-success ms-2">Current Week</span>
        {% endif %}
    </div>
    
    <div class="week-nav-buttons">
        <a href="{{ url_for('index', week_offset=week_offset-1) }}" class="btn btn-outline-primary nav-btn">
            <i class="fas fa-chevron-left"></i>
            <span class="d-none d-sm-inline">Previous</span>
        </a>
        
        <a href="{{ url_for('index', week_offset=week_offset+1) }}" class="btn btn-outline-primary nav-btn">
            <span class="d-none d-sm-inline">Next</span>
            <i class="fas fa-chevron-right"></i>
        </a>
    </div>
</div>

{% if week_offset == 0 %}
<div class="alert alert-info text-center">
    <i class="fas fa-info-circle me-2"></i>
    <span class="d-none d-sm-inline">You are viewing the current week. Use the navigation above to view other weeks.</span>
    <span class="d-sm-none">Current week view. Use arrows to navigate.</span>
</div>
{% endif %}

<!-- Mobile-optimized table -->
<div class="table-responsive">
    <table class="table table-bordered schedule-table">
        <thead>
            <tr>
                <th style="min-width: 60px;">Time</th>
                {% for date in week_dates %}
                <th style="min-width: 80px;">
                    <div class="d-none d-md-block">{{ date.display }}</div>
                    <div class="d-md-none">{{ date.date[-2:] }}/{{ date.date[5:7] }}</div>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for time_slot in time_slots %}
            <tr>
                <td class="time-slot">
                    <div class="d-none d-sm-block">{{ time_slot }}</div>
                    <div class="d-sm-none" style="font-size: 0.6em;">{{ time_slot }}</div>
                </td>
                {% for date in week_dates %}
                <td class="{% if schedule[date.date][time_slot] %}booked{% else %}available{% endif %}"
                    {% if not schedule[date.date][time_slot] %}
                    onclick="location.href='{{ url_for('quick_book', date=date.date, time=time_slot, week_offset=week_offset) }}'"
                    title="Click to book {{ time_slot }} on {{ date.display }}"
                    style="cursor: pointer;"
                    {% endif %}>
                    {% if schedule[date.date][time_slot] %}
                        <div class="d-none d-md-block">{{ schedule[date.date][time_slot] }}</div>
                        <div class="d-md-none" style="font-size: 0.6em;">{{ schedule[date.date][time_slot][:8] }}{% if schedule[date.date][time_slot]|length > 8 %}...{% endif %}</div>
                    {% else %}
                        <div class="d-none d-sm-block">
                            <span class="quick-book-hint">Available</span>
                        </div>
                        <div class="d-sm-none" style="font-size: 0.6em; color: #28a745;">
                            ✓
                        </div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Action button -->
<div class="mt-3 text-center">
    <a href="{{ url_for('book', week_offset=week_offset) }}" class="btn btn-primary btn-lg">
        <i class="fas fa-plus-circle"></i> Book Meeting Room
    </a>
</div>

<!-- Legend - responsive layout -->
<div class="row mt-4 g-3">
    <div class="col-12 col-md-6">
        <div class="alert alert-success mb-0">
            <strong><i class="fas fa-check-circle me-2"></i>Available:</strong> 
            <span class="d-none d-sm-inline">Click on any available slot to book quickly</span>
            <span class="d-sm-none">Tap to book</span>
        </div>
    </div>
    <div class="col-12 col-md-6">
        <div class="alert alert-danger mb-0">
            <strong><i class="fas fa-times-circle me-2"></i>Booked:</strong> 
            <span class="d-none d-sm-inline">Time slots already reserved by teams</span>
            <span class="d-sm-none">Reserved slots</span>
        </div>
    </div>
</div>

<!-- Quick booking help for mobile -->
<div class="d-sm-none">
    <div class="alert alert-info mt-3">
        <small>
            <i class="fas fa-mobile-alt me-1"></i>
            Tap any green ✓ to quickly book that time slot
        </small>
    </div>
</div>

{% endblock %}
