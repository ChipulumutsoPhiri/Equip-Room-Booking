{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">
        <i class="fas fa-car text-success me-2"></i>
        Company Car Schedule
    </h2>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
        <i class="fas fa-home me-1"></i>Back to Home
    </a>
</div>

<!-- Week Navigation -->
<div class="week-navigation {% if week_info.is_current_week %}current-week{% endif %}">
    <div class="week-display">
        {{ week_info.week_display }}
        {% if week_info.is_current_week %}
            <span class="badge bg-success ms-2">Current Week</span>
        {% endif %}
    </div>
    
    <div class="week-nav-buttons">
        <a href="{{ url_for('car_index', week_offset=week_offset-1) }}" class="btn btn-outline-success nav-btn">
            <i class="fas fa-chevron-left"></i>
            <span class="d-none d-sm-inline">Previous</span>
        </a>
        
        <a href="{{ url_for('car_index', week_offset=week_offset+1) }}" class="btn btn-outline-success nav-btn">
            <span class="d-none d-sm-inline">Next</span>
            <i class="fas fa-chevron-right"></i>
        </a>
    </div>
</div>

{% if week_offset == 0 %}
<div class="alert alert-success">
    <i class="fas fa-info-circle me-2"></i>
    <span class="d-none d-sm-inline">Current week view. Car is available for booking during open slots.</span>
    <span class="d-sm-none">Current week. Tap green slots to book.</span>
</div>
{% endif %}

<!-- Car availability table -->
<div class="table-responsive">
    <table class="table table-bordered schedule-table">
        <thead>
            <tr class="table-success">
                <th style="min-width: 60px;">Time</th>
                {% for date in week_dates %}
                <th style="min-width: 80px;">
                    <div class="d-none d-md-block">{{ date.display }}</div>
                    <div class="d-md-none">{{ date.date[-2:] }}/{{ date.date[5:7] }}</div>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for time_slot in time_slots %}
            <tr>
                <td class="time-slot">
                    <div class="d-none d-sm-block">{{ time_slot }}</div>
                    <div class="d-sm-none" style="font-size: 0.6em;">{{ time_slot }}</div>
                </td>
                {% for date in week_dates %}
                <td class="{% if schedule[date.date][time_slot] %}booked-car{% else %}available-car{% endif %}"
                    {% if not schedule[date.date][time_slot] %}
                    onclick="location.href='{{ url_for('car_quick_book', date=date.date, time=time_slot, week_offset=week_offset) }}'"
                    title="Click to book car for {{ time_slot }} on {{ date.display }}"
                    style="cursor: pointer;"
                    {% endif %}>
                    {% if schedule[date.date][time_slot] %}
                        <div class="d-none d-md-block">
                            <i class="fas fa-user me-1"></i>{{ schedule[date.date][time_slot] }}
                        </div>
                        <div class="d-md-none" style="font-size: 0.6em;">
                            <i class="fas fa-user"></i> {{ schedule[date.date][time_slot][:6] }}{% if schedule[date.date][time_slot]|length > 6 %}...{% endif %}
                        </div>
                    {% else %}
                        <div class="d-none d-sm-block">
                            <i class="fas fa-car me-1"></i>
                            <span class="quick-book-hint">Available</span>
                        </div>
                        <div class="d-sm-none" style="font-size: 0.6em; color: #28a745;">
                            <i class="fas fa-car"></i>
                        </div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Action buttons -->
<div class="mt-3 text-center">
    <a href="{{ url_for('car_book', week_offset=week_offset) }}" class="btn btn-success btn-lg me-2">
        <i class="fas fa-plus-circle"></i> Book Car
    </a>
    <a href="{{ url_for('car_bookings') }}" class="btn btn-outline-success">
        <i class="fas fa-list"></i> View All Bookings
    </a>
</div>

<!-- Legend - responsive layout -->
<div class="row mt-4 g-3">
    <div class="col-12 col-md-6">
        <div class="alert alert-success mb-0">
            <strong><i class="fas fa-car me-2"></i>Available:</strong> 
            <span class="d-none d-sm-inline">Click on any available slot to book the car</span>
            <span class="d-sm-none">Tap to book car</span>
        </div>
    </div>
    <div class="col-12 col-md-6">
        <div class="alert alert-danger mb-0">
            <strong><i class="fas fa-user me-2"></i>Booked:</strong> 
            <span class="d-none d-sm-inline">Car is already reserved by someone</span>
            <span class="d-sm-none">Car is reserved</span>
        </div>
    </div>
</div>

<!-- Car booking info for mobile -->
<div class="d-sm-none">
    <div class="alert alert-info mt-3">
        <small>
            <i class="fas fa-mobile-alt me-1"></i>
            Tap any <i class="fas fa-car"></i> icon to quickly book the car for that time slot
        </small>
    </div>
</div>

<style>
/* Car-specific styling */
.booked-car { 
    background-color: #f8d7da; 
    color: #721c24;
    font-weight: bold;
    padding: 8px;
    text-align: center;
    border-radius: 4px;
}

.available-car { 
    background-color: #d4edda; 
    cursor: pointer; 
    transition: background-color 0.2s;
    padding: 8px;
    text-align: center;
    border-radius: 4px;
}

.available-car:hover {
    background-color: #c3e6cb;
}

.week-navigation {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    border-radius: 15px;
}

.week-navigation .week-display {
    color: white;
}

.week-navigation .btn-outline-success {
    border-color: white;
    color: white;
}

.week-navigation .btn-outline-success:hover {
    background-color: white;
    color: #28a745;
}

.current-week {
    background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
    border: 2px solid #fd7e14 !important;
}

.current-week .week-display {
    color: white;
}
</style>
{% endblock %}