{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">
        <i class="fas fa-door-open text-primary me-2"></i>
        Meeting Room Schedule
    </h2>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
        <i class="fas fa-home me-1"></i>Back to Home
    </a>
</div>

<!-- Week Navigation -->
<div class="week-navigation {% if week_info.is_current_week %}current-week{% endif %}">
    <div class="week-display">
        {{ week_info.week_display }}
        {% if week_info.is_current_week %}
            <span class="badge bg-primary ms-2">Current Week</span>
        {% endif %}
    </div>
    
    <div class="week-nav-buttons">
        <a href="{{ url_for('room_index', week_offset=week_offset-1) }}" class="btn btn-outline-primary nav-btn">
            <i class="fas fa-chevron-left"></i>
            <span class="d-none d-sm-inline">Previous</span>
        </a>
        
        <a href="{{ url_for('room_index', week_offset=week_offset+1) }}" class="btn btn-outline-primary nav-btn">
            <span class="d-none d-sm-inline">Next</span>
            <i class="fas fa-chevron-right"></i>
        </a>
    </div>
</div>

{% if week_offset == 0 %}
<div class="alert alert-primary">
    <i class="fas fa-info-circle me-2"></i>
    <span class="d-none d-sm-inline">Current week view. Meeting room is available for booking during open slots.</span>
    <span class="d-sm-none">Current week. Tap blue slots to book.</span>
</div>
{% endif %}

<!-- Meeting room availability table -->
<div class="table-responsive">
    <table class="table table-bordered schedule-table">
        <thead>
            <tr class="table-primary">
                <th style="min-width: 60px;">Time</th>
                {% for date in week_dates %}
                <th style="min-width: 80px;">
                    <div class="d-none d-md-block">{{ date.display }}</div>
                    <div class="d-md-none">{{ date.date[-2:] }}/{{ date.date[5:7] }}</div>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for time_slot in time_slots %}
            <tr>
                <td class="time-slot">
                    <div class="d-none d-sm-block">{{ time_slot }}</div>
                    <div class="d-sm-none" style="font-size: 0.6em;">{{ time_slot }}</div>
                </td>
                {% for date in week_dates %}
                <td class="{% if schedule[date.date][time_slot] %}booked-room{% else %}available-room{% endif %}"
                    {% if not schedule[date.date][time_slot] %}
                    onclick="location.href='{{ url_for('room_quick_book', date=date.date, time=time_slot, week_offset=week_offset) }}'"
                    title="Click to book meeting room for {{ time_slot }} on {{ date.display }}"
                    style="cursor: pointer;"
                    {% endif %}>
                    {% if schedule[date.date][time_slot] %}
                        <div class="d-none d-md-block">
                            <i class="fas fa-user me-1"></i>{{ schedule[date.date][time_slot] }}
                        </div>
                        <div class="d-md-none" style="font-size: 0.6em;">
                            <i class="fas fa-user"></i> {{ schedule[date.date][time_slot][:6] }}{% if schedule[date.date][time_slot]|length > 6 %}...{% endif %}
                        </div>
                    {% else %}
                        <div class="d-none d-sm-block">
                            <i class="fas fa-door-open me-1"></i>
                            <span class="quick-book-hint">Available</span>
                        </div>
                        <div class="d-sm-none" style="font-size: 0.6em; color: #007bff;">
                            <i class="fas fa-door-open"></i>
                        </div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Action buttons -->
<div class="mt-3 text-center">
    <a href="{{ url_for('room_book', week_offset=week_offset) }}" class="btn btn-primary btn-lg me-2">
        <i class="fas fa-plus-circle"></i> Book Room
    </a>
    <a href="{{ url_for('room_bookings') }}" class="btn btn-outline-primary">
        <i class="fas fa-list"></i> View All Bookings
    </a>
</div>

<!-- Legend - responsive layout -->
<div class="row mt-4 g-3">
    <div class="col-12 col-md-6">
        <div class="alert alert-primary mb-0">
            <strong><i class="fas fa-door-open me-2"></i>Available:</strong> 
            <span class="d-none d-sm-inline">Click on any available slot to book the meeting room</span>
            <span class="d-sm-none">Tap to book room</span>
        </div>
    </div>
    <div class="col-12 col-md-6">
        <div class="alert alert-danger mb-0">
            <strong><i class="fas fa-user me-2"></i>Booked:</strong> 
            <span class="d-none d-sm-inline">Room is already reserved by someone</span>
            <span class="d-sm-none">Room is reserved</span>
        </div>
    </div>
</div>

<!-- Room booking info for mobile -->
<div class="d-sm-none">
    <div class="alert alert-info mt-3">
        <small>
            <i class="fas fa-mobile-alt me-1"></i>
            Tap any <i class="fas fa-door-open"></i> icon to quickly book the room for that time slot
        </small>
    </div>
</div>

<style>
/* Room-specific styling */
.booked-room { 
    background-color: #f8d7da; 
    color: #721c24;
    font-weight: bold;
    padding: 8px;
    text-align: center;
    border-radius: 4px;
}

.available-room { 
    background-color: #cce7ff; 
    cursor: pointer; 
    transition: background-color 0.2s;
    padding: 8px;
    text-align: center;
    border-radius: 4px;
}

.available-room:hover {
    background-color: #b3d9ff;
}

.week-navigation {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    border-radius: 15px;
    padding: 1rem;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.week-navigation .week-display {
    color: white;
    font-size: 1.1rem;
    font-weight: 600;
}

.week-navigation .week-nav-buttons {
    display: flex;
    gap: 0.5rem;
}

.week-navigation .btn-outline-primary {
    border-radius: 25px;
    font-weight: 500;
    border: 2px solid #fff;
    color: #212529 !important;
    background: #fff !important;
    transition: background 0.2s, color 0.2s;
}

.week-navigation .btn-outline-primary:hover {
    background: #007bff !important;
    color: #fff !important;
    border-color: #007bff !important;
}

.current-week {
    background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
    border: 2px solid #fd7e14 !important;
}

.current-week .week-display {
    color: white;
}

.schedule-table {
    border: 2px solid #007bff;
    border-radius: 8px;
    overflow: hidden;
}

.time-slot {
    background-color: #f8f9fa;
    font-weight: 600;
    text-align: center;
}

@media (max-width: 768px) {
    .week-navigation {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .week-nav-buttons {
        justify-content: center;
    }
}
</style>
{% endblock %}
